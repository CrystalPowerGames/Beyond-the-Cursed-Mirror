#include <ultra64.h>
#include "sm64.h"
#include "behavior_data.h"
#include "model_ids.h"
#include "seq_ids.h"
#include "dialog_ids.h"
#include "segment_symbols.h"
#include "level_commands.h"

#include "game/level_update.h"

#include "levels/scripts.h"

#include "actors/common1.h"

/* Fast64 begin persistent block [includes] */
/* Fast64 end persistent block [includes] */

#include "make_const_nonconst.h"
#include "levels/ttm/header.h"

/* Fast64 begin persistent block [scripts] */
/* Fast64 end persistent block [scripts] */

const LevelScript level_ttm_entry[] = {
	INIT_LEVEL(),
	LOAD_YAY0(0x07, _ttm_segment_7SegmentRomStart, _ttm_segment_7SegmentRomEnd), 
	LOAD_YAY0_TEXTURE(0x09, _mountain_yay0SegmentRomStart, _mountain_yay0SegmentRomEnd), 
	LOAD_YAY0(0x0A, _water_skybox_yay0SegmentRomStart, _water_skybox_yay0SegmentRomEnd), 
	LOAD_YAY0(0x05, _group6_yay0SegmentRomStart, _group6_yay0SegmentRomEnd), 
	LOAD_RAW(0x0C, _group6_geoSegmentRomStart, _group6_geoSegmentRomEnd), 
	LOAD_YAY0(0x08, _common0_yay0SegmentRomStart, _common0_yay0SegmentRomEnd), 
	LOAD_RAW(0x0F, _common0_geoSegmentRomStart, _common0_geoSegmentRomEnd), 
	ALLOC_LEVEL_POOL(),
	MARIO(MODEL_MARIO, 0x00000001, bhvMario), 
	JUMP_LINK(script_func_global_1), 
	JUMP_LINK(script_func_global_7), 
	LOAD_MODEL_FROM_GEO(MODEL_KILLER_LASER, killerlaser_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_BEAN, bean_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_MIC, mic_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_PINK_COIN_TTM, pink_coin_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_ALIENTREE, alientree_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_ALIENBALL, alienball_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_MILL, mill_geo), 
	LOAD_MODEL_FROM_GEO(MODEL_VFLOOD, vflood_geo), 

	/* Fast64 begin persistent block [level commands] */
	/* Fast64 end persistent block [level commands] */

	AREA(1, ttm_area_1),
		WARP_NODE(0x0A, LEVEL_BOB, 0x01, 0x0A, WARP_NO_CHECKPOINT),
		WARP_NODE(240/*win*/, LEVEL_BITS, 0x01, 0x06, WARP_NO_CHECKPOINT),
		WARP_NODE(241/*death*/, LEVEL_BITS, 0x01, 0x05, WARP_NO_CHECKPOINT),
		WARP_NODE(0x03, LEVEL_TTM, 0x01, 0x02, WARP_NO_CHECKPOINT),
		WARP_NODE(0x02, LEVEL_TTM, 0x01, 0x03, WARP_NO_CHECKPOINT),
		WARP_NODE(0x04, LEVEL_TTM, 0x02, 0x0A, WARP_NO_CHECKPOINT),
		WARP_NODE(0x05, LEVEL_TTM, 0x03, 0x0A, WARP_NO_CHECKPOINT),
		OBJECT(MODEL_1UP, -10463, 6354, -7732, 0, 0, 0, 0x00000000, bhv1Up),
		OBJECT(MODEL_1UP, -8418, 1403, 8747, 0, 0, 0, 0x00000000, bhv1Up),
		OBJECT(MODEL_ALIENBALL, -3901, 1492, -10192, 0, 0, 0, (2 << 24), bhvAlienball),
		OBJECT(MODEL_ALIENBALL, -761, 668, 2384, 0, 0, 0, (2 << 24), bhvAlienball),
		OBJECT(MODEL_ALIENBALL, -12659, 644, -7598, 0, 0, 0, (2 << 24), bhvAlienball),
		OBJECT(MODEL_ALIENBALL, -9019, 1355, 2384, 0, 0, 0, (2 << 24), bhvAlienball),
		OBJECT(MODEL_ALIENBALL, -40, 602, 10383, 0, 0, 0, (2 << 24), bhvAlienball),
		OBJECT(MODEL_BLUE_COIN_SWITCH, -3412, 279, 7808, 0, 0, 0, 0x00000000, bhvBlueCoinSwitch),
		OBJECT(MODEL_BLUE_COIN, -4286, 279, 6109, 0, 0, 0, 0x00000000, bhvHiddenBlueCoin),
		OBJECT(MODEL_BLUE_COIN, -4895, 279, 6109, 0, 0, 0, 0x00000000, bhvHiddenBlueCoin),
		OBJECT(MODEL_BLUE_COIN, -4582, 279, 5831, 0, 0, 0, 0x00000000, bhvHiddenBlueCoin),
		OBJECT(MODEL_BLUE_COIN, -7915, 363, 7761, 0, 0, 0, 0x00000000, bhvHiddenBlueCoin),
		OBJECT(MODEL_BLUE_COIN, -7915, 363, 8345, 0, 0, 0, 0x00000000, bhvHiddenBlueCoin),
		OBJECT(MODEL_BLUE_COIN, -7915, 363, 8935, 0, 0, 0, 0x00000000, bhvHiddenBlueCoin),
		OBJECT(MODEL_BLUE_COIN, -6245, 76, 6850, 0, 0, 0, 0x00000000, bhvHiddenBlueCoin),
		OBJECT(MODEL_NONE, 4396, 4898, -7245, 0, 132, 0, (0 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, 2628, 363, 1061, 0, -172, 0, (0 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, -6184, 677, 2601, 0, -90, 0, (0 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, 3264, 363, -5993, 0, 132, 0, (0 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, 4612, 363, -6592, 0, 64, 0, (0 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, -1416, 841, -11592, 0, 127, 0, (0 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, -7905, 704, 5780, 0, 0, 0, (0 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, 4711, 841, -10145, 0, 18, 0, (0 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, 3093, 2725, -5644, 0, 32, 0, (0 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, -1313, 363, -1880, 0, 127, 0, (2 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, -846, 1361, 1000, 0, 127, 0, (2 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, -5736, 363, 1508, 0, 127, 0, (2 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, -5261, 3086, -9462, 0, 0, 0, (2 << 16), bhvFadingWarp),
		OBJECT(MODEL_NONE, 8996, 517, 12235, 0, 0, 0, (3 << 16), bhvFadingWarp),
		OBJECT(0xEF, -2285, 1721, 12738, 0, 0, 0, 0x00000000, bhvGreenCoin),
		OBJECT(0xEF, -7901, 363, 4148, 0, 0, 0, 0x00000000, bhvGreenCoin),
		OBJECT(0xEF, 4462, 363, -4961, 0, 0, 0, 0x00000000, bhvGreenCoin),
		OBJECT(0xEF, 10659, 517, 10381, 0, 0, 0, 0x00000000, bhvGreenCoin),
		OBJECT(0xEF, -10835, 4909, -7188, 0, 0, 0, 0x00000000, bhvGreenCoin),
		OBJECT(0xEF, 10152, 2668, 11646, 0, 0, 0, 0x00000000, bhvGreenCoin),
		OBJECT(0xEF, 9926, 2668, 11646, 0, 0, 0, 0x00000000, bhvGreenCoin),
		OBJECT(0xEF, 9669, 2668, 11723, 0, 0, 0, 0x00000000, bhvGreenCoin),
		OBJECT(MODEL_KILLER_LASER, 8874, 10998, 10428, 0, 0, 0, 0x00000000, bhvKillerLaser),
		OBJECT(MODEL_NONE, -1849, 1652, 1502, 0, -133, 0, (0x0A << 16), bhvSpinAirborneWarp),
		MARIO_POS(0x01, -133, -1746, 363, 1224),
		OBJECT(MODEL_MIC, 4406, 4749, -9929, 0, 0, 0, (1 << 16), bhvMic),
		OBJECT(MODEL_NOTEBLOCK, -7694, 1830, 10872, 0, 0, 0, 0x00000000, bhvNoteblock),
		OBJECT(MODEL_NOTEBLOCK, -7479, 2071, 461, 0, 0, 0, 0x00000000, bhvNoteblock),
		OBJECT(MODEL_NOTEBLOCK, 1794, 695, -7556, 0, 0, 0, 0x00000000, bhvNoteblock),
		OBJECT(MODEL_NOTEBLOCK, 2434, 1796, -7080, 0, 0, 0, 0x00000000, bhvNoteblock),
		OBJECT(MODEL_NOTEBLOCK, 3773, 2971, -4948, 0, 0, 0, 0x00000000, bhvNoteblock),
		OBJECT(MODEL_NOTEBLOCK, 4430, 4230, -5996, 0, 0, 0, 0x00000000, bhvNoteblock),
		OBJECT(MODEL_BEAN, -1891, 363, 481, 0, 0, 0, (109 << 16), bhvBean),
		OBJECT(MODEL_BEAN, 3780, 358, -6854, 0, 45, 0, (110 << 16), bhvBean),
		OBJECT(MODEL_BEAN, 9364, 2668, 8877, 0, 161, 0, (111 << 16), bhvBean),
		OBJECT(MODEL_YELLOW_COIN, 8996, 517, 12235, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_MARIO, -2080, 363, -1570, 0, 0, 0, 0x00000000, bhvPhantasm),
		OBJECT(MODEL_MARIO, -7157, 2728, -8439, 0, 106, 0, 0x00000000, bhvPhantasm),
		OBJECT(MODEL_MARIO, 3065, 2725, -5702, 0, -146, 0, (1 << 16), bhvPhantasm),
		OBJECT(MODEL_MARIO, -7901, 363, 8211, 0, 171, 0, 0x00000000, bhvPhantasm),
		OBJECT(MODEL_MARIO, -40, 262, 10872, 0, 171, 0, 0x00000000, bhvPhantasm),
		OBJECT(MODEL_MARIO, 9158, 517, 6813, 0, 171, 0, 0x00000000, bhvPhantasm),
		OBJECT(MODEL_MARIO, 2107, 841, -12863, 0, 88, 0, 0x00000000, bhvPhantasm),
		OBJECT(MODEL_MARIO, 3130, 841, -12483, 0, -134, 0, 0x00000000, bhvPhantasm),
		OBJECT(MODEL_PINK_COIN_TTM, 7297, 1187, 9826, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_PINK_COIN_TTM, 11493, 893, 8676, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_PINK_COIN_TTM, 2783, 841, -12587, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_PINK_COIN_TTM, -8713, 363, 1957, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_PINK_COIN_TTM, -7451, 1403, 8630, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_PINK_COIN_TTM, -3175, 2304, 11026, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_PINK_COIN_TTM, 3910, 363, -6007, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_PINK_COIN_TTM, -846, 1361, 1000, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_NONE, 6741, 1211, 8449, 0, 0, 0, (3 << 24), bhvHiddenRedCoinStar),
		OBJECT(MODEL_PURPLE_SWITCH, -4939, 279, 12524, 0, 0, 0, (1 << 24) | (45 << 16), bhvPurpleSwitchHiddenBoxes),
		OBJECT(0xEB, 1701, 1392, 6212, 0, 90, 0, 0x00000000, bhvGoldRing),
		OBJECT(0xEB, -2654, 1624, -5961, 0, -180, -29, 0x00000000, bhvGoldRing),
		OBJECT(0xEB, -5238, 961, 7956, 0, 97, 0, 0x00000000, bhvGoldRing),
		OBJECT(0xEB, -12513, 1397, 5865, -39, -108, 40, 0x00000000, bhvGoldRing),
		OBJECT(0xEB, -8649, 980, -12683, 0, -180, 0, 0x00000000, bhvGoldRing),
		OBJECT(MODEL_EXCLAMATION_BOX, 2134, 773, 989, 0, 0, 0, (3 << 16), bhvExclamationBox),
		OBJECT(MODEL_EXCLAMATION_BOX, 9041, 600, 4898, 0, 0, 0, (3 << 16), bhvExclamationBox),
		OBJECT(MODEL_EXCLAMATION_BOX, -2189, 677, 544, 0, 0, 0, (3 << 16), bhvExclamationBox),
		OBJECT(MODEL_EXCLAMATION_BOX, -6421, 660, 282, 0, 0, 0, (3 << 16), bhvExclamationBox),
		OBJECT(MODEL_EXCLAMATION_BOX, -4656, 556, 6109, 0, 0, 0, (3 << 16), bhvExclamationBox),
		OBJECT(MODEL_EXCLAMATION_BOX, -12839, 579, -8250, 0, 0, 0, (3 << 16), bhvExclamationBox),
		OBJECT(MODEL_EXCLAMATION_BOX, -5408, 603, 12252, 0, 0, 0, (3 << 16), bhvExclamationBox),
		OBJECT(MODEL_STAR, 667, 5159, -12653, 0, 0, 0, (0 << 24), bhvStar),
		OBJECT(MODEL_ALIENTREE, -697, 841, -11954, 0, 0, 0, 0x00000000, bhvAlienTree),
		OBJECT(MODEL_ALIENTREE, 4800, 363, -8629, 0, -55, 0, 0x00000000, bhvAlienTree),
		OBJECT(MODEL_ALIENTREE, 3149, 2725, -7576, 0, -55, 0, 0x00000000, bhvAlienTree),
		OBJECT(MODEL_ALIENTREE, -5207, 279, 11224, 0, 36, 0, 0x00000000, bhvAlienTree),
		OBJECT(MODEL_ALIENTREE, -1232, 279, 12482, 0, 55, 0, 0x00000000, bhvAlienTree),
		OBJECT(MODEL_ALIENTREE, 11581, 517, 11317, 0, -16, 0, 0x00000000, bhvAlienTree),
		OBJECT(MODEL_ALIENTREE, 9869, 2668, 8939, 0, 51, 0, 0x00000000, bhvAlienTree),
		OBJECT(MODEL_ALIENTREE, -1398, 764, -404, 0, 100, 0, 0x00000000, bhvAlienTree),
		OBJECT(MODEL_ALIENTREE, -11851, 363, -7620, 0, 25, 0, 0x00000000, bhvAlienTree),
		OBJECT(MODEL_ALIENTREE, 3541, 4898, -7134, 0, -40, 0, 0x00000000, bhvAlienTree),
		OBJECT(MODEL_ALIENTREE, 6973, 2668, 11412, 0, 157, 0, 0x00000000, bhvAlienTree),
		OBJECT(MODEL_NONE, 3867, 2725, -8048, 0, 127, 0, (1 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, -3175, 2164, 12471, 0, 127, 0, (1 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, -1397, 1721, 11147, 0, 127, 0, (1 << 16), bhvCoinFormation),
		OBJECT(MODEL_NONE, -9983, 4948, -7875, 0, 0, 0, (4 << 16), bhvWarp),
		OBJECT(MODEL_NONE, -7479, 1916, 1508, 0, 0, 0, (30 << 24) | (5 << 16), bhvWarp),
		TERRAIN(ttm_area_1_collision),
		MACRO_OBJECTS(ttm_area_1_macro_objs),
		SET_BACKGROUND_MUSIC(0x00, SEQ_COSMIC_SEED_LEVEL),
		TERRAIN_TYPE(TERRAIN_GRASS),
		/* Fast64 begin persistent block [area commands] */
		/* Fast64 end persistent block [area commands] */
	END_AREA(),

	AREA(2, ttm_area_2),
		WARP_NODE(0x0A, LEVEL_BOB, 0x01, 0x0A, WARP_NO_CHECKPOINT),
		WARP_NODE(240/*win*/, LEVEL_BITS, 0x01, 0x06, WARP_NO_CHECKPOINT),
		WARP_NODE(241/*death*/, LEVEL_BITS, 0x01, 0x05, WARP_NO_CHECKPOINT),
		WARP_NODE(0x03, LEVEL_TTM, 0x01, 0x02, WARP_NO_CHECKPOINT),
		WARP_NODE(0x02, LEVEL_TTM, 0x01, 0x03, WARP_NO_CHECKPOINT),
		WARP_NODE(0x04, LEVEL_TTM, 0x02, 0x0A, WARP_NO_CHECKPOINT),
		OBJECT(MODEL_1UP, -735, -2530, 0, 0, 0, 0, 0x00000000, bhv1Up),
		OBJECT(MODEL_1UP, 719, -2530, 0, 0, 0, 0, 0x00000000, bhv1Up),
		OBJECT(MODEL_MILL, 0, -3029, 0, 0, 0, 0, 0x00000000, bhvMill),
		OBJECT(MODEL_NONE, 843, -1818, 0, 0, -90, 0, (0x0A << 16), bhvInstantActiveWarp),
		OBJECT(MODEL_NONE, -826, 3620, 0, 0, 0, 0, (4 << 24), bhvStar),
		TERRAIN(ttm_area_2_collision),
		MACRO_OBJECTS(ttm_area_2_macro_objs),
		SET_BACKGROUND_MUSIC(0x00, SEQ_LEVEL_UNDERGROUND),
		TERRAIN_TYPE(TERRAIN_GRASS),
		/* Fast64 begin persistent block [area commands] */
		/* Fast64 end persistent block [area commands] */
	END_AREA(),

	AREA(3, ttm_area_3),
		WARP_NODE(0x0A, LEVEL_BOB, 0x01, 0x0A, WARP_NO_CHECKPOINT),
		WARP_NODE(240/*win*/, LEVEL_BITS, 0x01, 0x06, WARP_NO_CHECKPOINT),
		WARP_NODE(241/*death*/, LEVEL_BITS, 0x01, 0x05, WARP_NO_CHECKPOINT),
		WARP_NODE(0x03, LEVEL_TTM, 0x01, 0x02, WARP_NO_CHECKPOINT),
		WARP_NODE(0x02, LEVEL_TTM, 0x01, 0x03, WARP_NO_CHECKPOINT),
		WARP_NODE(0x04, LEVEL_TTM, 0x02, 0x0A, WARP_NO_CHECKPOINT),
		OBJECT(MODEL_1UP, -1146, 2912, -436, 0, 0, 0, 0x00000000, bhv1Up),
		OBJECT(MODEL_NONE, -1100, -3755, -168, 0, 126, 0, (0x0A << 16), bhvInstantActiveWarp),
		OBJECT(MODEL_NOTEBLOCK, 562, -1158, 520, 0, -33, 0, 0x00000000, bhvNoteblock),
		OBJECT(MODEL_NOTEBLOCK, 103, 2365, 285, 0, 0, 0, 0x00000000, bhvNoteblock),
		OBJECT(MODEL_STAR, 35, 4323, 178, 0, 0, 0, (6 << 24), bhvStar),
		OBJECT(MODEL_VFLOOD, 181, -4589, 73, 0, 0, 0, 0x00000000, bhvVflood),
		TERRAIN(ttm_area_3_collision),
		MACRO_OBJECTS(ttm_area_3_macro_objs),
		SET_BACKGROUND_MUSIC(0x00, SEQ_EVENT_BOSS),
		TERRAIN_TYPE(TERRAIN_GRASS),
		/* Fast64 begin persistent block [area commands] */
		/* Fast64 end persistent block [area commands] */
	END_AREA(),

	FREE_LEVEL_POOL(),
	MARIO_POS(0x01, -133, -1746, 363, 1224),
	CALL(0, lvl_init_or_update),
	CALL_LOOP(1, lvl_init_or_update),
	CLEAR_LEVEL(),
	SLEEP_BEFORE_EXIT(1),
	EXIT(),
};
